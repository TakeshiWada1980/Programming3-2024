<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="robots" content="noindex,nofollow,noarchive" />
    <meta name="referrer" content="no-referrer" />

    <script>
      MathJax = {
        chtml: {
          displayAlign: "left",
          displayIndent: "1em",
        },
      };
    </script>

    

    <link rel="icon" href="favicon.ico" sizes="any" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c"
    />
    <link rel="stylesheet" href="style.css" />

    <title>第07回 3I-プログラミング3</title>
  </head>

  <body>
    <div class="openbtn"><span></span><span></span><span></span></div>
    <nav id="g-nav">
      <div id="g-nav-list">
        <!-- ---------------------------------------- -->
         <ul>
<li><a href="#連絡" id="toc-連絡"><span
class="toc-section-number">1</span> 連絡</a>
<ul>
<li><a href="#課題1について" id="toc-課題1について"><span
class="toc-section-number">1.1</span> 課題1について</a></li>
<li><a href="#今後の授業の流れ" id="toc-今後の授業の流れ"><span
class="toc-section-number">1.2</span> 今後の授業の流れ</a></li>
</ul></li>
<li><a href="#投稿記事の詳細を表示するコンテンツの作成"
id="toc-投稿記事の詳細を表示するコンテンツの作成"><span
class="toc-section-number">2</span>
投稿記事の「詳細」を表示するコンテンツの作成</a>
<ul>
<li><a href="#ハイパーリンクの追加" id="toc-ハイパーリンクの追加"><span
class="toc-section-number">2.1</span> ハイパーリンクの追加</a></li>
<li><a href="#記事詳細ページの作成" id="toc-記事詳細ページの作成"><span
class="toc-section-number">2.2</span> 記事詳細ページの作成</a></li>
</ul></li>
<li><a href="#ウェブapiの利用" id="toc-ウェブapiの利用"><span
class="toc-section-number">3</span> ウェブAPIの利用</a>
<ul>
<li><a href="#ウェブapiとは" id="toc-ウェブapiとは"><span
class="toc-section-number">3.1</span> ウェブAPIとは</a></li>
<li><a href="#郵便番号検索apiの組込み"
id="toc-郵便番号検索apiの組込み"><span
class="toc-section-number">3.2</span> 郵便番号検索APIの組込み</a></li>
<li><a href="#非同期処理" id="toc-非同期処理"><span
class="toc-section-number">3.3</span> 非同期処理</a></li>
</ul></li>
<li><a href="#microcms" id="toc-microcms"><span
class="toc-section-number">4</span> microCMS</a></li>
<li><a href="#ああああ" id="toc-ああああ"><span
class="toc-section-number">5</span> ああああ</a></li>
</ul> 
        <!-- ---------------------------------------- -->
      </div>
    </nav>

    <header class="markdown-body">
      <p>2024-3I プログラミング3 第07回 講義資料</p>
      <p>2024年11月21日（木）1・2時限</p>
    </header>

    <main class="markdown-body">
      <!-- ---------------------------------------- -->
      <h1 data-number="1" id="連絡"><span
      class="header-section-number">1</span> 連絡</h1>
      <h2 data-number="1.1" id="課題1について"><span
      class="header-section-number">1.1</span> 課題1について</h2>
      <p><a
      href="lecture05.html#課題1">課題1</a><font size=-1>(ぼくのかんがえたさいきょうのTodoアプリ)</font>
      の提出期限は「<strong>11月27日 (水)
      23時</strong>」です。GoogleClassroom の
      <strong>提出ボタンの押下忘れ</strong>
      などが無いように注意してください
      (提出遅れや不備は減点となります)。なお、<code>README.md</code>
      の内容も評価対象に含まれるので忘れずに記載してください。</p>
      <ul>
      <li>課題1は、ポートフォリオ (自己紹介と作品集)
      として作成したページからも
      <strong>リンクを貼っておくように</strong> してください。</li>
      <li>その他、ポートフォリには
      <strong>今年度の文化祭展示の概要</strong>
      (スクリーンショットや会場写真があると説得力が高くなります)
      や、他科目で開発したソフトウエアや修得したスキルなども、(記憶が鮮明なうちに)
      こまめに追記するようにしてください。<br />
      </li>
      <li>特に、文化祭展示などは <span
      class="masked">チームプロジェクトでの開発の経験があること</span>
      のアピールになってくるので必ず記載してください。</li>
      </ul>
      <p>作成済みTodoの編集機能、カテゴリ機能、カウントダウン機能、カレンダUI機能など、様々な工夫が考えられます。個性とユーモアが輝く作品を期待します。</p>
      <h2 data-number="1.2" id="今後の授業の流れ"><span
      class="header-section-number">1.2</span> 今後の授業の流れ</h2>
      <p>大まかな流れは、次のようになっています。</p>
      <ol type="1">
      <li>Next.js 開発環境の構築</li>
      <li>ブログアプリの「<strong>フロントエンド開発</strong>」のチュートリアル
      <strong>← 今回の授業</strong>
      <ul>
      <li><a href="https://microcms.io/">microCMS</a> の利用</li>
      </ul></li>
      <li>ブログアプリの「<strong>バックエンド開発</strong>」のチュートリアル
      <strong>← 次回の授業</strong>
      <ul>
      <li><a href="https://supabase.com/">supabase</a> と <a
      href="https://vercel.com/">varcel</a> の利用</li>
      </ul></li>
      <li>ブログアプリのカスタマイズとつくり込み →
      <strong><em>課題2</em></strong></li>
      <li>オリジナルのウェブアプリ → <strong><em>課題3</em></strong>
      (最終課題)</li>
      </ol>
      <h1 data-number="2"
      id="投稿記事の詳細を表示するコンテンツの作成"><span
      class="header-section-number">2</span>
      投稿記事の「詳細」を表示するコンテンツの作成</h1>
      <p>トップページに表示される記事一覧の各記事をクリックすると、次のように
      <strong>詳細ページに遷移する機能</strong> や
      <strong>外部サイトの画像を表示する機能</strong>
      を実装していきます。</p>
      <figure>
      <img src="figs/07/app_03.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <p>ここでは <code>/posts/[id]</code> というパスで記事の詳細 (全文)
      とカバーイメージ (画像) が表示されるようにしていきます。Next.js
      において <code>[id]</code> のような表記は <span
      class="masked">パラメータプレースホルダ</span> とよばれ、そこには
      <strong>動的に値が入ること</strong> を示します。</p>
      <p>具体的には、次のように<a
      href="https://github.com/TakeshiWada1980/Programming3-2024/blob/main/docs/codes/06/dummyPosts.ts">記事のID</a>を表す文字列が
      <code>[id]</code> の部分に埋め込まれるURLパターンを
      <code>/posts/[id]</code> のように表記します。</p>
      <ul>
      <li>投稿1
      <code>/posts/36b7c693-4cce-4d73-afa3-acb54a404290</code></li>
      <li>投稿2
      <code>/posts/24f932b8-231b-429b-b9dc-569f07ba16a7</code></li>
      <li>投稿3
      <code>/posts/1d4cbd35-6ec2-4f34-b3e7-4a9b35a60d1a</code></li>
      </ul>
      <h2 data-number="2.1" id="ハイパーリンクの追加"><span
      class="header-section-number">2.1</span> ハイパーリンクの追加</h2>
      <p>以上の機能を実装するために、まずは <code>PostSummary.tsx</code>
      のJSX要素のなかに
      <code>&lt;Link href={`/posts/${post.id}`}&gt;...&lt;Link&gt;</code>
      というハイパーリンクを追加してください。Linkコンポーネントは「文字列」だけではなく、次のように
      <span class="masked">div要素</span> を囲むことができます。</p>
      <div class="sourceCode" id="cb1"
      data-caption="src/app/_components/PostSummary.tsx (抜粋・実装例)"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1"></a>{<span class="co">/* ファイルの先頭で「Linkコンポーネント」のインポートが必要です */</span>}</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="op">&lt;</span>Link href<span class="op">=</span>{<span class="vs">`/posts/</span><span class="sc">${</span>post<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs">`</span>}<span class="op">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;mb-1 text-lg font-bold&quot;</span><span class="op">&gt;</span>{post<span class="op">.</span><span class="at">title</span>}<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="op">&lt;</span>div</span>
<span id="cb1-5"><a href="#cb1-5"></a>    className<span class="op">=</span><span class="st">&quot;line-clamp-3&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    dangerouslySetInnerHTML<span class="op">=</span>{{ __html<span class="op">:</span> safeHTML }}</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="op">/&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="op">&lt;/</span>Link<span class="op">&gt;</span></span></code></pre></div>
      <p><code>href={`/posts/${post.id}`}</code> によって
      <strong>動的にハイパーリンク先が設定されていること</strong>
      を確認してください。なお、Linkコンポーネントのインポートについては、既に実装済みの
      <code>Header.tsx</code> などを参照してください。</p>
      <p>上記の変更ができたら、現時点でハイパーリンクが機能すること
      (=<strong>記事概要をクリックするとブラウザのアドレバーのパスが変化すること</strong>)
      を確認してください。また、リンク先のコンテンツが存在しない場合は、どのような画面表示になるかも実際に確認してください。</p>
      <p>開発では、<span class="masked">(いまさらですが)
      こまめに部分的に動作確認を繰り返すこと</span>
      が重要です。また、デベロッパーツールのコンソールタブで、エラーや警告が発生していないことも定期的に確認するように努めてください。</p>
      <h2 data-number="2.2" id="記事詳細ページの作成"><span
      class="header-section-number">2.2</span> 記事詳細ページの作成</h2>
      <p>つづいてリンク先のコンテンツ (=記事詳細ページ)
      を作成していきます。まずは、次のような構成になるようにフォルダを追加してください。つまり、<code>/src/app</code>
      のなかに <code>posts</code>
      フォルダを作成して、そのフォルダのなかに <code>[id]</code>
      フォルダを作成してください。前回講義でも解説したように Next.js
      ではフォルダ構成が <span
      class="masked">そのまま「URLパス」と対応する仕組み</span>
      となっているため、フォルダの「<strong>名前設定</strong>」や「<strong>階層構造</strong>」には十分に注意を払ってください。</p>
      <figure>
      <img src="figs/07/vscode_01.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <p>次に <code>[id]</code> フォルダのなかに <code>page.tsx</code>
      というファイルを作成して以下の内容を記述してください。</p>
      <div class="sourceCode" id="cb2"
      data-caption="src/app/posts/[id]/page.tsx"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript"><span id="cb2-1"><a href="#cb2-1"></a><span class="st">&quot;use client&quot;</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">import</span> { useState<span class="op">,</span> useEffect } <span class="im">from</span> <span class="st">&quot;react&quot;</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">import</span> { useParams } <span class="im">from</span> <span class="st">&quot;next/navigation&quot;</span><span class="op">;</span> <span class="co">// ◀ 注目</span></span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="im">import</span> <span class="im">type</span> { Post } <span class="im">from</span> <span class="st">&quot;@/app/_types/Post&quot;</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="im">import</span> dummyPosts <span class="im">from</span> <span class="st">&quot;@/app/_mocks/dummyPosts&quot;</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="im">import</span> { FontAwesomeIcon } <span class="im">from</span> <span class="st">&quot;@fortawesome/react-fontawesome&quot;</span><span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="im">import</span> { faSpinner } <span class="im">from</span> <span class="st">&quot;@fortawesome/free-solid-svg-icons&quot;</span><span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="im">import</span> Image <span class="im">from</span> <span class="st">&quot;next/image&quot;</span><span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="im">import</span> DOMPurify <span class="im">from</span> <span class="st">&quot;isomorphic-dompurify&quot;</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">// 投稿記事の詳細表示 /posts/[id]</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="kw">const</span> Page<span class="op">:</span> React<span class="op">.</span><span class="at">FC</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="kw">const</span> [post<span class="op">,</span> setPost] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>Post <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="kw">const</span> [isLoading<span class="op">,</span> setIsLoading] <span class="op">=</span> <span class="fu">useState</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17"></a></span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="co">// 動的ルートパラメータから id を取得 （URL:/posts/[id]）</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>  <span class="kw">const</span> { id } <span class="op">=</span> <span class="fu">useParams</span>() <span class="im">as</span> { id<span class="op">:</span> <span class="dt">string</span> }<span class="op">;</span></span>
<span id="cb2-20"><a href="#cb2-20"></a></span>
<span id="cb2-21"><a href="#cb2-21"></a>  <span class="co">// コンポーネントが読み込まれたときに「1回だけ」実行する処理</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb2-23"><a href="#cb2-23"></a>    <span class="co">// 本来はウェブAPIを叩いてデータを取得するが、まずはモックデータを使用</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="co">// (ネットからのデータ取得をシミュレートして１秒後にデータをセットする)</span></span>
<span id="cb2-25"><a href="#cb2-25"></a>    <span class="fu">setIsLoading</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>    <span class="kw">const</span> timer <span class="op">=</span> <span class="pp">setTimeout</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb2-27"><a href="#cb2-27"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;ウェブAPIからデータを取得しました (虚言)&quot;</span>)<span class="op">;</span></span>
<span id="cb2-28"><a href="#cb2-28"></a>      <span class="co">// dummyPosts から id に一致する投稿を取得してセット</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>      <span class="fu">setPost</span>(dummyPosts<span class="op">.</span><span class="fu">find</span>((post) <span class="kw">=&gt;</span> post<span class="op">.</span><span class="at">id</span> <span class="op">===</span> id) <span class="op">||</span> <span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>      <span class="fu">setIsLoading</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31"></a>    }<span class="op">,</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a>    <span class="co">// データ取得の途中でページ遷移したときにタイマーを解除する処理</span></span>
<span id="cb2-34"><a href="#cb2-34"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> <span class="pp">clearTimeout</span>(timer)<span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>  }<span class="op">,</span> [id])<span class="op">;</span></span>
<span id="cb2-36"><a href="#cb2-36"></a></span>
<span id="cb2-37"><a href="#cb2-37"></a>  <span class="co">// 投稿データの取得中は「Loading...」を表示</span></span>
<span id="cb2-38"><a href="#cb2-38"></a>  <span class="cf">if</span> (isLoading) {</span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="cf">return</span> (</span>
<span id="cb2-40"><a href="#cb2-40"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;text-gray-500&quot;</span><span class="op">&gt;</span></span>
<span id="cb2-41"><a href="#cb2-41"></a>        <span class="op">&lt;</span>FontAwesomeIcon icon<span class="op">=</span>{faSpinner} className<span class="op">=</span><span class="st">&quot;mr-1 animate-spin&quot;</span> <span class="op">/&gt;</span></span>
<span id="cb2-42"><a href="#cb2-42"></a>        Loading<span class="op">...</span></span>
<span id="cb2-43"><a href="#cb2-43"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb2-44"><a href="#cb2-44"></a>    )<span class="op">;</span></span>
<span id="cb2-45"><a href="#cb2-45"></a>  }</span>
<span id="cb2-46"><a href="#cb2-46"></a></span>
<span id="cb2-47"><a href="#cb2-47"></a>  <span class="co">// 投稿データが取得できなかったらエラーメッセージを表示</span></span>
<span id="cb2-48"><a href="#cb2-48"></a>  <span class="cf">if</span> (<span class="op">!</span>post) {</span>
<span id="cb2-49"><a href="#cb2-49"></a>    <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>指定idの投稿の取得に失敗しました。<span class="op">&lt;/</span>div<span class="op">&gt;;</span></span>
<span id="cb2-50"><a href="#cb2-50"></a>  }</span>
<span id="cb2-51"><a href="#cb2-51"></a></span>
<span id="cb2-52"><a href="#cb2-52"></a>  <span class="co">// HTMLコンテンツのサニタイズ</span></span>
<span id="cb2-53"><a href="#cb2-53"></a>  <span class="kw">const</span> safeHTML <span class="op">=</span> DOMPurify<span class="op">.</span><span class="fu">sanitize</span>(post<span class="op">.</span><span class="at">content</span><span class="op">,</span> {</span>
<span id="cb2-54"><a href="#cb2-54"></a>    ALLOWED_TAGS<span class="op">:</span> [<span class="st">&quot;b&quot;</span><span class="op">,</span> <span class="st">&quot;strong&quot;</span><span class="op">,</span> <span class="st">&quot;i&quot;</span><span class="op">,</span> <span class="st">&quot;em&quot;</span><span class="op">,</span> <span class="st">&quot;u&quot;</span><span class="op">,</span> <span class="st">&quot;br&quot;</span>]<span class="op">,</span></span>
<span id="cb2-55"><a href="#cb2-55"></a>  })<span class="op">;</span></span>
<span id="cb2-56"><a href="#cb2-56"></a></span>
<span id="cb2-57"><a href="#cb2-57"></a>  <span class="cf">return</span> (</span>
<span id="cb2-58"><a href="#cb2-58"></a>    <span class="op">&lt;</span>main<span class="op">&gt;</span></span>
<span id="cb2-59"><a href="#cb2-59"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;space-y-2&quot;</span><span class="op">&gt;</span></span>
<span id="cb2-60"><a href="#cb2-60"></a>        <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;mb-2 text-2xl font-bold&quot;</span><span class="op">&gt;</span>{post<span class="op">.</span><span class="at">title</span>}<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb2-61"><a href="#cb2-61"></a>        <span class="op">&lt;</span>div<span class="op">&gt;</span></span>
<span id="cb2-62"><a href="#cb2-62"></a>          <span class="op">&lt;</span>Image</span>
<span id="cb2-63"><a href="#cb2-63"></a>            src<span class="op">=</span>{post<span class="op">.</span><span class="at">coverImage</span><span class="op">.</span><span class="at">url</span>}</span>
<span id="cb2-64"><a href="#cb2-64"></a>            alt<span class="op">=</span><span class="st">&quot;Example Image&quot;</span></span>
<span id="cb2-65"><a href="#cb2-65"></a>            width<span class="op">=</span>{post<span class="op">.</span><span class="at">coverImage</span><span class="op">.</span><span class="at">width</span>}</span>
<span id="cb2-66"><a href="#cb2-66"></a>            height<span class="op">=</span>{post<span class="op">.</span><span class="at">coverImage</span><span class="op">.</span><span class="at">height</span>}</span>
<span id="cb2-67"><a href="#cb2-67"></a>            priority</span>
<span id="cb2-68"><a href="#cb2-68"></a>            className<span class="op">=</span><span class="st">&quot;rounded-xl&quot;</span></span>
<span id="cb2-69"><a href="#cb2-69"></a>          <span class="op">/&gt;</span></span>
<span id="cb2-70"><a href="#cb2-70"></a>        <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb2-71"><a href="#cb2-71"></a>        <span class="op">&lt;</span>div dangerouslySetInnerHTML<span class="op">=</span>{{ __html<span class="op">:</span> safeHTML }} <span class="op">/&gt;</span></span>
<span id="cb2-72"><a href="#cb2-72"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb2-73"><a href="#cb2-73"></a>    <span class="op">&lt;/</span>main<span class="op">&gt;</span></span>
<span id="cb2-74"><a href="#cb2-74"></a>  )<span class="op">;</span></span>
<span id="cb2-75"><a href="#cb2-75"></a>}<span class="op">;</span></span>
<span id="cb2-76"><a href="#cb2-76"></a></span>
<span id="cb2-77"><a href="#cb2-77"></a><span class="im">export</span> <span class="im">default</span> Page<span class="op">;</span></span></code></pre></div>
      <p>ここで注目すべき処理は、<strong>URLパス</strong>
      (動的ルートパラメータの <code>[id]</code> の部分) から
      <code>id</code> の文字列を取得する処理と、その <code>id</code>
      に一致するデータを <code>dummyPosts</code> から検索して状態
      (state) にセットする処理になります。</p>
      <h3 data-number="2.2.1" id="パラメータプレースホルダの処理"><span
      class="header-section-number">2.2.1</span>
      パラメータプレースホルダの処理</h3>
      <p>パスから <code>id</code>
      を取得する処理は、<strong>第03行目</strong> でインポートしている
      <code>useParams</code> という Hook を利用して
      <strong>第19行目</strong> で行っています。これは <span
      class="masked">2個以上のパラメータプレースホルダ</span>
      にも対応しており、例えば <code>/posts/[categoryId]/[postId]</code>
      となっているときは、次のように値を取得することができます。</p>
      <div class="sourceCode" id="cb3"
      data-caption="パラメータプレースホルダからの値の取得"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">// src/app/posts/[categoryId]/[postId]/page.tsx</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">const</span> { categoryId<span class="op">,</span> postId } <span class="op">=</span> <span class="fu">useParams</span>() <span class="im">as</span> { categoryId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span> postId<span class="op">:</span> <span class="dt">string</span> }<span class="op">;</span></span></code></pre></div>
      <p>なお、パラメータプレースホルダに与えられるものが「数値」であっても、まずは「<strong>文字列</strong>」として取り出してから
      <span
      class="masked"><code>parseInt()</code>などを使用して数値に変換する必要</span>
      があります。</p>
      <h3 data-number="2.2.2" id="findメソッドによる検索"><span
      class="header-section-number">2.2.2</span>
      findメソッドによる検索</h3>
      <p><code>id</code> と一致する記事の取得は
      <strong>第29行目</strong> で、配列操作メソッドの <code>find</code>
      で行っています。<code>filter</code>
      は条件を満たす要素の「<strong>配列</strong>」を戻り値としましたが、<code>find</code>
      は条件を満たす <span class="masked">単一の要素
      (配列の先頭からチェックして一番初めに条件を満たした要素)</span>
      を戻り値とします。なお、条件に一致する要素が存在しなかった場合は
      <code>undefined</code> を返します。ここでは <code>undefined</code>
      ではなく <code>null</code>
      を使用したいので、次のようにしています。</p>
      <div class="sourceCode" id="cb4"
      data-caption="src/app/posts/[id]/page.tsx (抜粋)"
      data-startFrom="29"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript" style="counter-reset: source-line 28;"><span id="cb4-29"><a href="#cb4-29"></a><span class="fu">setPost</span>(dummyPosts<span class="op">.</span><span class="fu">find</span>((post) <span class="kw">=&gt;</span> post<span class="op">.</span><span class="at">id</span> <span class="op">===</span> id) <span class="op">||</span> <span class="kw">null</span>)<span class="op">;</span></span></code></pre></div>
      <div class="note type-tips">
      <p><strong>「null」と「undefined」の使い分けについて</strong></p>
      <p><code>null</code> と <code>undefined</code>
      は、条件式の内部で単体で評価したとき、同じ結果（falsyな値）となるなど同じような挙動を示すことがありますが、実際には<strong>様々な差異</strong>があります。そして、慣れないうちは、実際問題として<strong>両者の使い分けが難しい</strong>ということが多々あります。</p>
      <p>例えば <strong>第15行目</strong> では
      <code>useState&lt;Post | null&gt;(null)</code>
      としていますが、これを
      <code>useState&lt;Post | undefined&gt;(undefined)</code>
      としていない理由を説明しようとすると
      (理解するためには)、Typescript や Next.js、React
      に関しての一定の知識と経験が必要となります。また、<code>undefined</code>
      を利用しても、動作上、問題のないコードを書くことができます。</p>
      <p>たた、大まかな方針としては次のように使い分けると良いと思います。</p>
      <ul>
      <li><code>undefined</code>
      は言語システムが自動的に設定する値として考える</li>
      <li><code>null</code>
      は開発者が意図的に「値が存在しない」ことを表現したい場合に使用する</li>
      </ul>
      <p>両者の違いや、使い分けについては、時間があるときに生成AIを利用して
      (学習の段階に応じて) 徐々に理解を深めてください。</p>
      </div>
      <h3 data-number="2.2.3" id="不正なidを受け取ったときの処理"><span
      class="header-section-number">2.2.3</span>
      不正なidを受け取ったときの処理</h3>
      <p>ウェブブラウザのアドレバーに直接URLを入力した場合などは、不正なidを受け取ることがあります。<strong>第48行目</strong>
      から <strong>第50行目</strong>
      では、そのような場合の画面出力について設定しています。</p>
      <h3 data-number="2.2.4" id="動作確認と設定変更"><span
      class="header-section-number">2.2.4</span> 動作確認と設定変更</h3>
      <p><code>src/app/posts/[id]/page.tsx</code>
      を作成・保存したら開発モードで動作を確認してください。トップページの記事概要から詳細ページに移動すると、次のようなエラーが発生します。</p>
      <figure>
      <img src="figs/07/app_02.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <p>これは、エラーメッセージから読み取れるように、(<code>public</code>フォルダなどのプロジェクト内部に配置した画像ではなく)
      外部サイトから画像を取得して表示しようとしていることに起因します。Next.js
      のデフォルト設定では (セキュティとパフォーマンス最適化の観点から)
      <strong>外部からの画像の読込みが制限</strong>されています。</p>
      <p><strong>(プロンプト例)</strong></p>
      <blockquote>
      <p>Next.js
      のデフォルト設定では、外部からの画像の読込みが制限されています。この理由について教えてください。</p>
      </blockquote>
      <p>外部からの画像の読込みを許可するためには
      <code>next.config.mjs</code> を次のように変更します。</p>
      <div class="sourceCode" id="cb5"
      data-caption="next.config.mjs"><pre
      class="sourceCode numberSource js numberLines"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">/** </span><span class="an">@type</span><span class="co"> {import(&#39;next&#39;).NextConfig} */</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">const</span> nextConfig <span class="op">=</span> {</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">images</span><span class="op">:</span> {</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="dt">remotePatterns</span><span class="op">:</span> [</span>
<span id="cb5-5"><a href="#cb5-5"></a>      {</span>
<span id="cb5-6"><a href="#cb5-6"></a>        <span class="dt">protocol</span><span class="op">:</span> <span class="st">&quot;https&quot;</span><span class="op">,</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>        <span class="dt">hostname</span><span class="op">:</span> <span class="st">&quot;w1980.blob.core.windows.net&quot;</span><span class="op">,</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>      }<span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>    ]<span class="op">,</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  }<span class="op">,</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>}<span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="im">export</span> <span class="im">default</span> nextConfig<span class="op">;</span></span></code></pre></div>
      <p>複数のサイトを設定したいときは、次のように追加します。<a
      href="https://placehold.jp">placehold.jp</a>は、指定したサイズでダミー画像
      (モックアップ用の画像)
      を生成してくれるウェブサービスとなっています。ウェブアプリ開発で非常に役立つサービスなので覚えておいてください。</p>
      <div class="sourceCode" id="cb6"
      data-caption="next.config.mjs"><pre
      class="sourceCode numberSource js numberLines"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">/** </span><span class="an">@type</span><span class="co"> {import(&#39;next&#39;).NextConfig} */</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">const</span> nextConfig <span class="op">=</span> {</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="dt">images</span><span class="op">:</span> {</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="dt">remotePatterns</span><span class="op">:</span> [</span>
<span id="cb6-5"><a href="#cb6-5"></a>      {</span>
<span id="cb6-6"><a href="#cb6-6"></a>        <span class="dt">protocol</span><span class="op">:</span> <span class="st">&quot;https&quot;</span><span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>        <span class="dt">hostname</span><span class="op">:</span> <span class="st">&quot;w1980.blob.core.windows.net&quot;</span><span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>      }<span class="op">,</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>      { <span class="dt">protocol</span><span class="op">:</span> <span class="st">&quot;https&quot;</span><span class="op">,</span> <span class="dt">hostname</span><span class="op">:</span> <span class="st">&quot;placehold.jp&quot;</span> }<span class="op">,</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>    ]<span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>  }<span class="op">,</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>}<span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13"></a></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="im">export</span> <span class="im">default</span> nextConfig<span class="op">;</span></span></code></pre></div>
      <p><code>next.config.mjs</code>
      の変更後は、ホットリロードが効かないことがあるので、開発サーバを停止してから、再度、起動して動作を確認してください。次のように画像が表示されるはずです。</p>
      <figure>
      <img src="figs/07/app_01.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <h3 data-number="2.2.5" id="演習-宿題-30分"><span
      class="header-section-number">2.2.5</span> 演習 (宿題:
      <i class="fa-solid fa-stopwatch"></i> 30分)</h3>
      <p>記事詳細のページに「投稿日」と「カテゴリ」の情報が表示されるように実装を追加してください。またデザインなどをカスタマイズして、つくり込みをしてください。</p>
      <h1 data-number="3" id="ウェブapiの利用"><span
      class="header-section-number">3</span> ウェブAPIの利用</h1>
      <p>ここまではモックからブロの記事のデータを取得しましたが、これを
      <span
      class="masked">ウェブAPIを使ってバックエンドから取得できる</span>
      ように改良していきます。</p>
      <h2 data-number="3.1" id="ウェブapiとは"><span
      class="header-section-number">3.1</span> ウェブAPIとは</h2>
      <p>まずは、<a
      href="https://zipcloud.ibsnet.co.jp">zipcloud</a>が提供している<a
      href="https://zipcloud.ibsnet.co.jp/doc/api">郵便番号検索API</a>(=<strong>郵便番号から住所の取得が可能なウェブAPI</strong>)
      を対象に <strong>外部からデータを取得する処理</strong>
      について練習していきます。</p>
      <p>現在、ウェブAPIの多くは <strong>HTTP/HTTPS</strong> を使って
      <span class="masked">JSONフォーマット</span>
      でデータを取得することができるように設計・実装されています。<a
      href="https://zipcloud.ibsnet.co.jp/doc/api">郵便番号検索API</a>についても、<strong>HTTPSでリクエスト</strong>を送って、<strong>JSONフォーマット</strong>で住所データが取得できるサービスになっています。また、この先で開発していくブログアプリのバックエンドについても、そのように設計・実装していきます。</p>
      <p><a
      href="https://zipcloud.ibsnet.co.jp/doc/api">郵便番号検索API</a>は（認証などのヘッダ情報などが不要なので）ブラウザからでも利用することができます。実際にウェブブラウザのアドレスバーに次のURLを入力してみてください。以下のようにJSONフォーマットのレスポンスが得られます。</p>
      <ul>
      <li><code>https://zipcloud.ibsnet.co.jp/api/search?zipcode=572-0832</code></li>
      </ul>
      <figure>
      <img src="figs/07/api_01.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <p>また、次のように <strong>不正なリクエスト</strong>
      を送信すると、どのようなレスポンスが返ってくるのかを把握しておいてください。</p>
      <ul>
      <li><code>https://zipcloud.ibsnet.co.jp/api/search?zipcode=999-9999</code></li>
      <li><code>https://zipcloud.ibsnet.co.jp/api/search?zipcode=ABC</code></li>
      </ul>
      <p>なお、URL (URI) のなかで <code>?</code> 以降の部分を <span
      class="masked">クエリパラメータ (Query Parameter)</span>
      や「<strong>クエリ文字列 (Query
      String)</strong>」と呼びます。クエリパラメータは、ウェブサーバーに対して追加のパラメータを送信するために使用され
      <code>パラメータ名=値</code>
      の形式で指定します。複数のパラメータを指定する場合は
      <code>&amp;</code> で区切ります。例えば、<code>limit=5</code>
      というパラメータを追加したい場合は <span
      class="masked"><code>?zipcode=999-9999&amp;limit=5</code></span>
      のようにクエリパラメータを与えます。</p>
      <div class="note type-tips">
      <p><strong>URLエンコード</strong></p>
      <p>クエリパラメータに <strong>特殊文字</strong>
      (スペース、日本語、記号など)
      を使用したい場合があります。しかし、このような文字をそのままURLに使用すると問題が発生する可能性があるため、<span class="masked">URLエンコード
      (パーセントエンコード)</sapn>
      という処理で安全な文字列に変換する必要があります。</p>
      <p>例えば、半角スペースは <code>%20</code>、「大阪」という文字は
      <code>%E5%A4%A7%E9%98%AA</code>
      のようにURLエンコーディングすることができます。JavaScript
      では組込み関数の encodeURI() や encodeURIComponent()
      を使用してURLエンコーディングができます
      (2つの関数の差異については生成AIで調べてください)。</p>
      <p>以下のURLは、<code>tbm=isch</code> と <code>q=大阪</code>
      というクエリパラメータを与えている例となります。</p>
      <ul>
      <li><code>https://www.google.com/search?tbm=isch&amp;q=%E5%A4%A7%E9%98%AA</code></li>
      </ul>
      </div>
      <h2 data-number="3.2" id="郵便番号検索apiの組込み"><span
      class="header-section-number">3.2</span>
      郵便番号検索APIの組込み</h2>
      <p>以上のような処理を Next.js
      のコンポーネントのなかで実行し、そこから得たデータに基づいてコンテンツを表示する仕組みを実装をしていきます。</p>
      <p>具体的には
      <code>http://localhost:3000/playground/zip-code/572-0832</code>
      にアクセスしたとき、次のように画面が表示されるように設計・実装していきます。</p>
      <figure>
      <img src="figs/07/app_04.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <p>まずは <code>src/app</code> に <code>playground</code>
      というフォルダを作成して、そこに <code>zip-code</code>
      というサブフォルダを作成してください。さらに <code>zip-code</code>
      のなかに <code>[code]</code> というフォルダを作成して、そこに
      <code>page.tsx</code> を作成してください。</p>
      <pre><code>📂 src/app/
└─ 📂 playground/
    └─ 📂 zip-code/
        └─ 📂 [code]/
            └─ page.tsx</code></pre>
      <p><code>page.tsx</code> には、以下の内容を記述してください。</p>
      <div class="sourceCode" id="cb8"
      data-caption="src/app/playground/zip-code/[code]/page.tsx"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript"><span id="cb8-1"><a href="#cb8-1"></a><span class="st">&quot;use client&quot;</span><span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="im">import</span> { useState<span class="op">,</span> useEffect } <span class="im">from</span> <span class="st">&quot;react&quot;</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="im">import</span> { useParams } <span class="im">from</span> <span class="st">&quot;next/navigation&quot;</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">const</span> Page<span class="op">:</span> React<span class="op">.</span><span class="at">FC</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="kw">const</span> endpoint <span class="op">=</span> <span class="st">&quot;https://zipcloud.ibsnet.co.jp/api/search&quot;</span><span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="kw">const</span> { code } <span class="op">=</span> <span class="fu">useParams</span>() <span class="im">as</span> { code<span class="op">:</span> <span class="dt">string</span> }<span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="kw">const</span> [response<span class="op">,</span> setResponse] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span>(<span class="st">&quot;APIからデータを取得中...&quot;</span>)<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb8-11"><a href="#cb8-11"></a>    <span class="kw">const</span> fetchAddressFromZipCode  <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb8-12"><a href="#cb8-12"></a>      <span class="co">// ウェブAPIにGETリクエストを送信してレスポンスを取得</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>      <span class="kw">const</span> requestUrl <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>endpoint<span class="sc">}</span><span class="vs">?zipcode=</span><span class="sc">${</span>code<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(requestUrl<span class="op">,</span> { <span class="co">// ◀◀ 注目</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>        method<span class="op">:</span> <span class="st">&quot;GET&quot;</span><span class="op">,</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>        cache<span class="op">:</span> <span class="st">&quot;no-store&quot;</span><span class="op">,</span> <span class="co">// キャッシュを利用しない</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>      })<span class="op">;</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&quot;ウェブAPIからデータを取得しました&quot;</span>)<span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19"></a></span>
<span id="cb8-20"><a href="#cb8-20"></a>      <span class="co">// レスポンスからJSON形式でデータ取得して整形して表示</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>      <span class="kw">const</span> parsedData <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span> <span class="co">// ◀◀ 注目</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>      <span class="fu">setResponse</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(parsedData<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>    }<span class="op">;</span></span>
<span id="cb8-24"><a href="#cb8-24"></a></span>
<span id="cb8-25"><a href="#cb8-25"></a>    <span class="fu">fetchAddressFromZipCode</span> ()<span class="op">;</span> <span class="co">// 関数を実行</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>  }<span class="op">,</span> [code])<span class="op">;</span></span>
<span id="cb8-27"><a href="#cb8-27"></a></span>
<span id="cb8-28"><a href="#cb8-28"></a>  <span class="cf">return</span> (</span>
<span id="cb8-29"><a href="#cb8-29"></a>    <span class="op">&lt;</span>main<span class="op">&gt;</span></span>
<span id="cb8-30"><a href="#cb8-30"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;mb-5 text-2xl font-bold&quot;</span><span class="op">&gt;</span>{<span class="vs">`郵便番号 </span><span class="sc">${</span>code<span class="sc">}</span><span class="vs"> の検索`</span>}<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;space-y-3&quot;</span><span class="op">&gt;</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>        <span class="op">&lt;</span>div<span class="op">&gt;</span>実行結果<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>        <span class="op">&lt;</span>pre className<span class="op">=</span><span class="st">&quot;rounded-md bg-green-100 p-3 text-sm&quot;</span><span class="op">&gt;</span>{response}<span class="op">&lt;/</span>pre<span class="op">&gt;</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb8-35"><a href="#cb8-35"></a>    <span class="op">&lt;/</span>main<span class="op">&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>  )<span class="op">;</span></span>
<span id="cb8-37"><a href="#cb8-37"></a>}<span class="op">;</span></span>
<span id="cb8-38"><a href="#cb8-38"></a></span>
<span id="cb8-39"><a href="#cb8-39"></a><span class="im">export</span> <span class="im">default</span> Page<span class="op">;</span></span></code></pre></div>
      <p>はじめに、開発モードで実行して動作を確認してください。</p>
      <p>このコードのなかで注目すべき箇所は <strong>第10行目</strong>
      から <strong>第26行目</strong> にかけての <code>useEffect</code>
      の処理になります。まず、処理は
      <code>useEffect(() =&gt; {...},[code])</code>
      のようになっており、これによって内部の処理は、<strong>Pageコンポーネントが読み込まれたとき
      (マウントされたとき)</strong> と、<code>code</code>
      が変更されたときだけ実行されるようになります
      (無駄にAPIにアクセスすることが無いように対処されています)。</p>
      <p><code>useEffect</code> の内部では、アロー関数形式で
      <code>fetchAddressFromZipCode</code> が定義され、それが
      <strong>第25行目</strong>
      で呼び出されています。<code>fetchAddressFromZipCode</code>
      の定義では <code>async</code> と <code>await</code> という<span
      class="masked">非同期処理</span>
      を扱うためのキーワードが使用されています。非同期処理については、次のセクションで解説します。ウェブAPIからデータを取得するメイン処理は
      <strong>第14行目</strong> の <code>fetch</code>
      という組み込み関数で行なわれています。</p>
      <p>fetch はウェブアプリの文脈では <span
      class="masked">データを外部から取得する</span> や <span
      class="masked">リモートのリソースを読み込んでくる</span>
      という意味になります。関数 <code>fetch</code>
      の第1引数にはウェブAPI の URL (エンドポイントとも呼ばれます)
      を与え、第2引数にはリクエストのオプション設定を与えます。</p>
      <hr />
      <p>なお、<strong>第33行目</strong> の
      <code>&lt;pre&gt;...&lt;/pre&gt;</code> は、<strong>Preformatted
      Text</strong> (整形済みテキスト)
      のためのタグで、タグに囲まれた子要素の内容を <span
      class="masked">「スペース」や「改行」などを等幅フォントでそのまま</span>
      で表示する機能を持ちます。</p>
      <h3 data-number="3.2.1" id="演習-5分"><span
      class="header-section-number">3.2.1</span> 演習
      (<i class="fa-solid fa-stopwatch"></i> 5分)</h3>
      <p><strong>第33行目</strong> の
      <code>&lt;pre&gt;...&lt;/pre&gt;</code>
      を以下のように書き換えて、画面表示がどのように変化するか確認してください。</p>
      <div class="sourceCode" id="cb9"
      data-caption="src/app/playground/zip-code/[code]/page.tsx (抜粋・変更前)"
      data-startFrom="32"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript" style="counter-reset: source-line 31;"><span id="cb9-32"><a href="#cb9-32"></a><span class="op">&lt;</span>pre className<span class="op">=</span><span class="st">&quot;rounded-md bg-green-100 p-3 text-sm&quot;</span><span class="op">&gt;</span>{response}<span class="op">&lt;/</span>pre<span class="op">&gt;</span></span></code></pre></div>
      <div class="sourceCode" id="cb10"
      data-caption="src/app/playground/zip-code/[code]/page.tsx (抜粋・変更後)"
      data-startFrom="32"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript" style="counter-reset: source-line 31;"><span id="cb10-32"><a href="#cb10-32"></a><span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;rounded-md bg-green-100 p-3 text-sm&quot;</span><span class="op">&gt;</span>{response}<span class="op">&lt;/</span>ｄiv<span class="op">&gt;</span></span></code></pre></div>
      <h2 data-number="3.3" id="非同期処理"><span
      class="header-section-number">3.3</span> 非同期処理</h2>
      <p>一般に我々が考えるプログラムは同期処理される。</p>
      <p>ここでの同期処理とは、端的に言えば、次のように命令が並べられているとき、処理1の完了を待って、処理2が開始されるということです。極々あたりまえと感じる動作になります。</p>
      <p>ここで、処理2が完了までに時間がかかる処理だったとします。</p>
      <h1 data-number="4" id="microcms"><span
      class="header-section-number">4</span> microCMS</h1>
      <figure>
      <img src="figs/07/cms_01.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_02.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_03.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_04.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_05.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_06.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_07.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_08.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_09.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_10.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_11.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_12.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_13.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_14.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_15.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_16.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_17.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_18.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_19.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_20.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_21.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_22.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_23.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_24.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <figure>
      <img src="figs/07/cms_25.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <h1 data-number="5" id="ああああ"><span
      class="header-section-number">5</span> ああああ</h1>
      <figure>
      <img src="figs/07/cms_13.png" alt="img" />
      <figcaption aria-hidden="true">img</figcaption>
      </figure>
      <div class="sourceCode" id="cb11"
      data-caption="src/app/page.tsx"><pre
      class="sourceCode numberSource ts numberLines"><code class="sourceCode typescript"><span id="cb11-1"><a href="#cb11-1"></a><span class="st">&quot;use client&quot;</span><span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="im">import</span> { useState<span class="op">,</span> useEffect } <span class="im">from</span> <span class="st">&quot;react&quot;</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="im">import</span> <span class="im">type</span> { Post } <span class="im">from</span> <span class="st">&quot;@/app/_types/Post&quot;</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="im">import</span> PostSummary <span class="im">from</span> <span class="st">&quot;@/app/_components/PostSummary&quot;</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="im">import</span> { FontAwesomeIcon } <span class="im">from</span> <span class="st">&quot;@fortawesome/react-fontawesome&quot;</span><span class="op">;</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="im">import</span> { faSpinner } <span class="im">from</span> <span class="st">&quot;@fortawesome/free-solid-svg-icons&quot;</span><span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="kw">const</span> Page<span class="op">:</span> React<span class="op">.</span><span class="at">FC</span> <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="kw">const</span> [posts<span class="op">,</span> setPosts] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span>Post[] <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  <span class="kw">const</span> [fetchError<span class="op">,</span> setFetchError] <span class="op">=</span> <span class="fu">useState</span><span class="op">&lt;</span><span class="dt">string</span> <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span>(<span class="kw">null</span>)<span class="op">;</span></span>
<span id="cb11-11"><a href="#cb11-11"></a></span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb11-13"><a href="#cb11-13"></a>    <span class="kw">const</span> fetchPosts <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb11-14"><a href="#cb11-14"></a>      <span class="cf">try</span> {</span>
<span id="cb11-15"><a href="#cb11-15"></a>        <span class="kw">const</span> requestUrl <span class="op">=</span> <span class="st">&quot;https://jg9awXXXXX.microcms.io/api/v1/posts&quot;</span><span class="op">;</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>        <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(requestUrl<span class="op">,</span> {</span>
<span id="cb11-17"><a href="#cb11-17"></a>          method<span class="op">:</span> <span class="st">&quot;GET&quot;</span><span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>          cache<span class="op">:</span> <span class="st">&quot;no-store&quot;</span><span class="op">,</span> <span class="co">// キャッシュを利用しない</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>          headers<span class="op">:</span> {</span>
<span id="cb11-20"><a href="#cb11-20"></a>            <span class="st">&quot;X-MICROCMS-API-KEY&quot;</span><span class="op">:</span> <span class="st">&quot;rePnewuXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span><span class="op">,</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>          }<span class="op">,</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>        })<span class="op">;</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>        <span class="cf">if</span> (<span class="op">!</span>response<span class="op">.</span><span class="at">ok</span>) {</span>
<span id="cb11-24"><a href="#cb11-24"></a>          <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&quot;データの取得に失敗しました&quot;</span>)<span class="op">;</span></span>
<span id="cb11-25"><a href="#cb11-25"></a>        }</span>
<span id="cb11-26"><a href="#cb11-26"></a>        <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>        <span class="co">// console.log(JSON.stringify(data, null, 2));</span></span>
<span id="cb11-28"><a href="#cb11-28"></a>        <span class="fu">setPosts</span>(data<span class="op">.</span><span class="at">contents</span>)<span class="op">;</span></span>
<span id="cb11-29"><a href="#cb11-29"></a>      } <span class="cf">catch</span> (e) {</span>
<span id="cb11-30"><a href="#cb11-30"></a>        <span class="fu">setFetchError</span>(</span>
<span id="cb11-31"><a href="#cb11-31"></a>          e <span class="kw">instanceof</span> <span class="bu">Error</span> <span class="op">?</span> e<span class="op">.</span><span class="at">message</span> <span class="op">:</span> <span class="st">&quot;予期せぬエラーが発生しました&quot;</span></span>
<span id="cb11-32"><a href="#cb11-32"></a>        )<span class="op">;</span></span>
<span id="cb11-33"><a href="#cb11-33"></a>      }</span>
<span id="cb11-34"><a href="#cb11-34"></a>    }<span class="op">;</span></span>
<span id="cb11-35"><a href="#cb11-35"></a>    <span class="fu">fetchPosts</span>()<span class="op">;</span></span>
<span id="cb11-36"><a href="#cb11-36"></a>  }<span class="op">,</span> [])<span class="op">;</span></span>
<span id="cb11-37"><a href="#cb11-37"></a></span>
<span id="cb11-38"><a href="#cb11-38"></a>  <span class="cf">if</span> (fetchError) {</span>
<span id="cb11-39"><a href="#cb11-39"></a>    <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>{fetchError}<span class="op">&lt;/</span>div<span class="op">&gt;;</span></span>
<span id="cb11-40"><a href="#cb11-40"></a>  }</span>
<span id="cb11-41"><a href="#cb11-41"></a></span>
<span id="cb11-42"><a href="#cb11-42"></a>  <span class="cf">if</span> (<span class="op">!</span>posts) {</span>
<span id="cb11-43"><a href="#cb11-43"></a>    <span class="cf">return</span> (</span>
<span id="cb11-44"><a href="#cb11-44"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;text-gray-500&quot;</span><span class="op">&gt;</span></span>
<span id="cb11-45"><a href="#cb11-45"></a>        <span class="op">&lt;</span>FontAwesomeIcon icon<span class="op">=</span>{faSpinner} className<span class="op">=</span><span class="st">&quot;mr-1 animate-spin&quot;</span> <span class="op">/&gt;</span></span>
<span id="cb11-46"><a href="#cb11-46"></a>        Loading<span class="op">...</span></span>
<span id="cb11-47"><a href="#cb11-47"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb11-48"><a href="#cb11-48"></a>    )<span class="op">;</span></span>
<span id="cb11-49"><a href="#cb11-49"></a>  }</span>
<span id="cb11-50"><a href="#cb11-50"></a></span>
<span id="cb11-51"><a href="#cb11-51"></a>  <span class="cf">return</span> (</span>
<span id="cb11-52"><a href="#cb11-52"></a>    <span class="op">&lt;</span>main<span class="op">&gt;</span></span>
<span id="cb11-53"><a href="#cb11-53"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;mb-2 text-2xl font-bold&quot;</span><span class="op">&gt;</span>Main<span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb11-54"><a href="#cb11-54"></a>      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;space-y-3&quot;</span><span class="op">&gt;</span></span>
<span id="cb11-55"><a href="#cb11-55"></a>        {posts<span class="op">.</span><span class="fu">map</span>((post) <span class="kw">=&gt;</span> (</span>
<span id="cb11-56"><a href="#cb11-56"></a>          <span class="op">&lt;</span>PostSummary key<span class="op">=</span>{post<span class="op">.</span><span class="at">id</span>} post<span class="op">=</span>{post} <span class="op">/&gt;</span></span>
<span id="cb11-57"><a href="#cb11-57"></a>        ))}</span>
<span id="cb11-58"><a href="#cb11-58"></a>      <span class="op">&lt;/</span>div<span class="op">&gt;</span></span>
<span id="cb11-59"><a href="#cb11-59"></a>    <span class="op">&lt;/</span>main<span class="op">&gt;</span></span>
<span id="cb11-60"><a href="#cb11-60"></a>  )<span class="op">;</span></span>
<span id="cb11-61"><a href="#cb11-61"></a>}<span class="op">;</span></span>
<span id="cb11-62"><a href="#cb11-62"></a></span>
<span id="cb11-63"><a href="#cb11-63"></a><span class="im">export</span> <span class="im">default</span> Page<span class="op">;</span></span></code></pre></div>
      <!-- ---------------------------------------- -->
    </main>

    <footer class="markdown-body">
      <p><a href="https://takeshiwada1980.github.io/Programming3-2024/">講義資料のIndexに移動</a></p>
    </footer>

    <script>
      window.onload = function () {
        // ナビゲーション関連
        let openBtn = document.getElementsByClassName("openbtn")[0];
        let navPnl = document.getElementById("g-nav");
        openBtn.onclick = () => {
          openBtn.classList.toggle("active");
          navPnl.classList.toggle("panelactive");
        };

        let items = navPnl.getElementsByTagName("a");
        Array.from(items).forEach((item) => {
          item.onclick = () => {
            openBtn.classList.toggle("active");
            navPnl.classList.toggle("panelactive");
          };
        });

        // マスク処理
        let maskedSpans = document.getElementsByClassName("masked");
        Array.from(maskedSpans).forEach((span) => {
          span.onclick = () => {
            span.classList.toggle("open");
          };
        });

        // data-startfrom 属性の行番号カウンタのリセット
        document.querySelectorAll("div.sourceCode").forEach(function (div) {
          var startFrom = div.getAttribute("data-startfrom");
          if (startFrom != null) {
            div.style.counterReset = "pg-line " + (startFrom - 1);
          }
        });

        // 画像にリンクを付与
        // let images = document.querySelectorAll("figure img");
        // Array.from(images).forEach((img) => {
        //   img.onclick = () => {
        //     location.href = img.getAttribute("src");
        //   };
        // });
      };
    </script>
  </body>
</html>
